\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\RequirePackage{luatex85}
\RequirePackage{ifluatex}
\ifluatex 
    \usepackage{fontspec}
    % \setmainfont{CMU Serif}%{Times New Roman}
    % \setsansfont{CMU Sans Serif}%{Arial}
    % \setmonofont{CMU Typewriter Text}%{Consolas}
    \defaultfontfeatures{Ligatures={TeX}}
\else
    \usepackage[utf8]{inputenc}
    \usepackage[T2A,T1]{fontenc}
\fi

%====================================
%========== Package import ==========
%====================================

%===== General typesetting =====
\RequirePackage[nopatch=item]{microtype}                                        % Interface to micro-typographic extensions (character protrusion font expansion, etc.)
\RequirePackage{datetime}                                                       % Custom date formats
\RequirePackage{paralist}           	                                        % Improved enumerate and itemize formatting
\RequirePackage{enumitem}           	                                        % Enumerate customization
\RequirePackage{dashrule}                                                       % Dashed lines
\RequirePackage{indentfirst}        	                                        % First paragraph of a chapter indentation
\RequirePackage{epigraph}					                                    % Epigraphs typesetting such as quotations at the start of a chapter
\RequirePackage{imakeidx}				                                        % One or more indexes typesetting (must be put prior to hyperref)
\RequirePackage[backend=biber,backref=false,style=ieee]{biblatex}               % Numbered references and overall bibliography support
\RequirePackage[style=american]{csquotes}                                       % Context sensitive quotation facilities (recommended when using biblatex with babel)
\RequirePackage[intoc]{nomencl}                                                 % Nomenclature glossary interface
\RequirePackage{listings}                                                       % Typeset source code

%===== Mathematical typesetting =====
\RequirePackage{amsmath}            	                                        % Mathematical typsetting package
\RequirePackage{amsthm}                                                         % Theorem styling package
\RequirePackage{mathtools}          	                                        % Auxilliary mathematical package
\RequirePackage{chngcntr}                                                       % Ability to control the equation counter

%===== Cross-referencing =====
\RequirePackage[pagebackref=false,hidelinks]{hyperref}                          % Hypertext links and cross-referencing commands
\RequirePackage[noabbrev,capitalise]{cleveref}                                  % Intelligent cross-referencing (must be put after amsmath and hyperref)

%===== Fonts =====
\RequirePackage{amsfonts}           	                                        % Mathematical fonts
\RequirePackage{fancyvrb}           	                                        % Improved typewritter fontstypographic books

%===== Symbols =====
\RequirePackage{amssymb}            	                                        % Mathematical symbols
\RequirePackage{bbding}             	                                        % More symbols
\RequirePackage{textcomp,gensymb}		                                        % Generic symbols for text and mathmode
\RequirePackage{siunitx}		                                                % SI typesetting standard package

%===== Tables =====
\RequirePackage{booktabs}           	                                        % Higher table quality
\RequirePackage{dcolumn}            	                                        % Alignment of numerical column by decimal point
\RequirePackage{multirow}                                                       % Multi-row cells

%===== Graphical interface =====
\RequirePackage{graphicx}           	                                        % Picture import
\RequirePackage{subcaption}                                                     % Subfigures and subcaptions
\RequirePackage{pdfpages}	                                                    % PDF import
\RequirePackage{pgfplots}                                                       % High-quality function plotting
\RequirePackage{tikz}                                                           % Vector drawing
\RequirePackage{svg}                                                            % SVG import (requires Inkscape installation)
\RequirePackage[off]{svg-extract}                                               % SVG text separation from graphics


%======================================
%========== Package settings ==========
%======================================

%===== SI units typesetting (siunitx) =====
\sisetup{input-digits = 0123456789\pi\mitpi}

%===== Equation counter adjustment (chngcntr) =====
\counterwithin{equation}{chapter}

%===== Hyperlinks (hyperref) =====
% \hypersetup{
% 	colorlinks,
% 	citecolor=blue,
% 	filecolor=black,
% 	linkcolor=blue,
% 	urlcolor=blue
% }

%===== Fixed plural reference formats (cleveref) =====
\crefformat{pluralequation}{equations~(#2#1#3)}
\Crefformat{pluralequation}{Equations~(#2#1#3)}

%===== Source code typsetting =====
\lstset{
    columns=fullflexible,
    xleftmargin=2em,
    xrightmargin=2em,
    frame=trBL,
    frameround=fttt,
    breaklines=false,
    breakindent=0pt,
    literate={"}{\textquotedbl}1 {'}{\textquotesingle}1,
    showstringspaces=false
}

%===== Epigraph format (epigraph) =====
\setlength{\epigraphwidth}{0.8\textwidth}
\renewcommand{\textflush}{flushright}
\renewcommand{\sourceflush}{flushright}
\let\originalepigraph\epigraph
\renewcommand\epigraph[2]{\originalepigraph{\textit{#1}}{\textsc{#2}}}

%===== Theorem styling (amsthm) =====
\makeatletter
\def\thmheadbrackets#1#2#3{%
	\thmname{#1}\thmnumber{\@ifnotempty{#1}{ }\@upn{#2}}%
	\thmnote{{ \the\thm@notefont[#3]}}}
\makeatother
\newtheoremstyle{non-theorem}{\topsep}{\topsep}{\normalfont}{}{\bfseries}{.}{1em}{\thmheadbrackets{#1}{#2}{#3}}
\theoremstyle{non-theorem}
\newtheorem{remark}{Remark}[section]
\newtheorem{example}[remark]{Example}

%===== Plotting (pgfplots) =====
\pgfplotsset{compat=1.17}

%===== Vector graphics (tikz) =====
\usetikzlibrary{patterns}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{calc}


%=======================================
%========== Document settings ==========
%=======================================

\setlength\parindent{\the\parindent}                                            % Paragraph vertical indentation
\setlength\parskip{0.5em}                                                       % Paragraph vertical indentation
% \emergencystretch=1em                                                           % Allow additional line-breaking pass

%==================================================
%========== Macros for effective writing ==========
%==================================================

%===== Blank page =====
\newcommand\blankpage{%
	\clearpage
	\vspace*{\fill}
	\begin{center}
		\begin{minipage}{.6\textwidth}
			\center
			\textsc{[This page intentionally left blank.]}
		\end{minipage}
	\end{center}
	\vfill % equivalent to \vspace{\fill}
	\clearpage
}

%===== Adaptive-size delimiters =====
\def\({\left(}
\def\){\right)}
\def\[{\left[}
\def\]{\right]}

%===== Binomial coefficient =====
\newcommand{\comb}[2]{
	\left( \begin{matrix}
		#1 \\
		#2
	\end{matrix} \right)
}

%===== Column vector =====
\newcount\colveccount
\newcommand*\colvec[1]{
	\global\colveccount#1
	\begin{pmatrix}
		\colvecnext
	}
	\def\colvecnext#1{
		#1
		\global\advance\colveccount-1
		\ifnum\colveccount>0
		\\
		\expandafter\colvecnext
		\else
	\end{pmatrix}
	\fi
}

%===== TEM/TE/TM waves =====
\newcommand{\TEM}{\text{TEM}}
\newcommand{\TE}[2]{\text{TE}_{#1#2}}
\newcommand{\TM}[2]{\text{TM}_{#1#2}}

% ===== Frequency range =====
\newcommand{\frequencyrange}{\qtyrange{4.7}{5.7}{\giga\hertz}}
\newcommand{\frekvencnipasmo}{\qtyrange[range-phrase=\text{\foreignlanguage{czech}{ a≈æ }}]{4.7}{5.7}{\giga\hertz}}

%==========================================
%========== Mathematical symbols ==========
%==========================================

%===== General mathematics =====
\renewcommand{\iff}{\Leftrightarrow}
\renewcommand{\tilde}{\widetilde}
\newcommand{\restr}{\!\!\upharpoonright}
\renewcommand{\vec}{\boldsymbol}

%===== Double-struck letters =====
\newcommand{\R}{{\mathbb R}}
\newcommand{\Z}{{\mathbb Z}}
\newcommand{\N}{{\mathbb N}}
\newcommand{\C}{{\mathbb C}}
\newcommand{\Q}{{\mathbb Q}}
\newcommand{\F}{{\mathbb F}}
\newcommand{\E}{{\mathbb E}}

%===== Differentials =====
\renewcommand{\d}{{\mathrm d}}
\newcommand{\p}{\partial}

%===== Standard symbols =====
\renewcommand{\l}{\ell}
\newcommand{\e}{\mathrm e}
\renewcommand{\i}{\mathrm i}

%===== Quantum mechanics =====
\newcommand{\h}{\hbar}

%============================================
%========== Mathematical operators ==========
%============================================

%===== RedeclareOperator definition =====
\makeatletter
\newcommand\RedeclareMathOperator{%
    \@ifstar{\def\rmo@s{m}\rmo@redeclare}{\def\rmo@s{o}\rmo@redeclare}%
}
% This is taken from \renew@command
\newcommand\rmo@redeclare[2]{%
    \begingroup \escapechar\m@ne\xdef\@gtempa{{\string#1}}\endgroup
    \expandafter\@ifundefined\@gtempa
        {\@latex@error{\noexpand#1undefined}\@ehc}%
        \relax
    \expandafter\rmo@declmathop\rmo@s{#1}{#2}}
% This is just \@declmathop without \@ifdefinable
\newcommand\rmo@declmathop[3]{%
    \DeclareRobustCommand{#2}{\qopname\newmcodes@#1{#3}}%
}
\@onlypreamble\RedeclareMathOperator
\makeatother

%===== General mathematics =====
\DeclareMathOperator{\argmax}{argmax}
\DeclareMathOperator{\argmin}{argmin}
\DeclareMathOperator{\Argmax}{arg\,max}
\DeclareMathOperator{\Argmin}{arg\,min}
\DeclareMathOperator{\res}{res}
\RedeclareMathOperator{\Re}{Re}
\RedeclareMathOperator{\Im}{Im}

%===== Derivatives =====
\newcommand{\nder}[3]{\frac{\d^{#1} #2}{\d #3^{#1}}}
\newcommand{\der}[2]{\nder{}{#1}{#2}}
\newcommand{\npder}[3]{\frac{\p^{#1} #2}{\p #3^{#1}}}
\newcommand{\pder}[2]{\npder{}{#1}{#2}}

%===== Statistics =====
\newcommand{\mean}[1]{{\left\langle #1\right\rangle}}
\DeclareMathOperator{\var}{Var}
\DeclareMathOperator{\covar}{Cov}
\DeclareMathOperator{\cor}{Cor}

%===== Mappings =====
\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\supp}{supp}
\DeclareMathOperator{\Iso}{Iso}
\DeclareMathOperator{\Lin}{Lin}
\DeclareMathOperator{\Hom}{Hom}

%===== Linear algebra =====
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\rank}{rank}
\RedeclareMathOperator{\ker}{ker}
\DeclareMathOperator{\defect}{def}
\newcommand{\norm}[1]{\left\lVert#1\right\rVert}

%===== Vector differential operators =====
\DeclareMathOperator{\grad}{\nabla}
\RedeclareMathOperator{\div}{\nabla\cdot}
\DeclareMathOperator{\curl}{\nabla\times}
\DeclareMathOperator{\Grad}{grad}
\DeclareMathOperator{\Div}{div}
\DeclareMathOperator{\Curl}{curl}

%===== Dirac notation =====
\newcommand{\ket}[1]{\left|#1\right\rangle}
\newcommand{\bra}[1]{\left\langle#1\right|}
\newcommand{\bracket}[2]{\langle#1\,|\,#2\rangle}
\newcommand{\braopket}[3]{\langle#1|#2|#3\rangle}
\newcommand{\str}[2]{\langle#1\rangle_{#2}}

%===== Cylindrical Hankel functions =====
\newcommand{\Hankel}[2]{{H^{(#1)}_{#2}}}
\newcommand{\Hankelhat}[2]{{\hat{H}^{(#1)}_{#2}}}
\newcommand{\Hankeltilde}[2]{{\tilde{H}^{(#1)}_{#2}}}

%===== Spherical Hankel functions =====
\newcommand{\hankel}[2]{{h^{(#1)}_{#2}}}
\newcommand{\hankelhat}[2]{{\hat{h}^{(#1)}_{#2}}}
\newcommand{\hankeltilde}[2]{{\tilde{h}^{(#1)}_{#2}}}
